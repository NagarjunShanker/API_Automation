package testScripts;

import org.testng.Assert;
import org.testng.annotations.DataProvider;
import org.testng.annotations.Test;

import basePackage.BaseClass;
import files.Payload;
import io.restassured.RestAssured;
import io.restassured.specification.RequestSpecification;

import static io.restassured.RestAssured.*;

public class DynamicJson extends BaseClass {

	/*
	 * This test will be conducted to add the books and verify the add is
	 * successful. Using the DataProvider the input of books is provided.
	 */
	@Test(dataProvider = "BooksToAdd")
	public static void addBook(String isbn, String asile) {

		String isbnNum = isbn;
		String asileNum = asile;

		// Giving the base URL
		RestAssured.baseURI = "http://216.10.245.166";
		RequestSpecification req = given().log().all().header("Content-Type", "application/json");
		String addBookRes = "/Library/Addbook.php";

		String response = performPost(req, addBookRes, Payload.addBook(isbnNum, asileNum));

		String reqRes = fetchValueByParsingStringToJson(response, "ID");

		System.out.println(reqRes);

		String requiredMsg = isbnNum + asileNum;

		Assert.assertEquals(requiredMsg, reqRes);

	}

	/*
	 * This test will be conducted to delete the books and verify the delete
	 * message.
	 */
	@Test(dataProvider = "BooksToDelete")
	public static void deleteBook(String isbn, String asile) {

		// Creating the book variable info
		String isbnNum = isbn;
		String asileNum = asile;

		// Fetching the Base URL
		RestAssured.baseURI = "http://216.10.245.166";

		// Creating the request
		RequestSpecification req = given().log().all().header("Content-Type", "application/json");

		// Creating an resource file path
		String reqRespath = "/Library/DeleteBook.php";

		// Calling the delete function from the base class
		String resp = performDelete(req, reqRespath, Payload.addBook(isbnNum, asileNum));

		// Calling the jsonParse method from base class
		String respMsg = fetchValueByParsingStringToJson(resp, "MSG");

		Assert.assertEquals(respMsg, "book is successfully deleted");

	}

	@DataProvider(name = "BooksToAdd")
	public static Object[][] getBookData() {
		return new Object[][] { { "This is", " test 1" }, { "This is ", " test 2" }, { "This is ", " test 3" } };
	}

	@DataProvider(name = "BooksToDelete")
	public static Object[][] getBookDeleteData() {
		return new Object[][] { { "This is", " test 1" }, { "This is ", " test 2" }, { "This is ", " test 3" } };
	}
	
}
